<!doctype html>
<html lang="en"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Admin Dashboard — FWF</title>

<!-- Favicon -->
<link rel="icon" type="image/png" sizes="32x32" href="assets/images/logo.png">
<link rel="icon" type="image/png" sizes="16x16" href="assets/images/logo.png">
<link rel="apple-touch-icon" href="assets/images/logo.png">
<link rel="shortcut icon" href="assets/images/logo.png">

<link rel="stylesheet" href="style.css"/>
<style>
.wrap{max-width:1100px;margin:24px auto;padding:0 16px}
.card{background:linear-gradient(180deg,#101623,#0d1320);border:1px solid #1f2937;border-radius:16px;padding:20px}
.row{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:16px}
.kpi{display:flex;flex-direction:column;gap:6px;background:#0b1220;border:1px solid #1f2937;border-radius:12px;padding:14px}
.kpi .val{font-size:22px;font-weight:800;color:#fff}
.kpi .lab{color:#94a3b8}
.table{width:100%;border-collapse:collapse}
.table th,.table td{border-bottom:1px solid #1f2937;padding:10px 8px;color:#cbd5e1;text-align:left}
</style>
</head><body>
<div class="wrap">
  <div class="card">
    <h2 style="color:#fff;margin:0 0 10px">Admin Overview</h2>
    <div class="row">
      <div class="kpi"><span class="lab">Total Members</span><span class="val" id="mcount">0</span></div>
      <div class="kpi"><span class="lab">Active Members</span><span class="val" id="acount">0</span></div>
    </div>
    <br>
    <h3 style="color:#cbd5e1">Latest Members <span style="font-size:14px;color:#94a3b8;font-weight:400">(Latest 20)</span></h3>
    <div style="overflow-x:auto">
      <table class="table" id="tbl">
        <thead>
          <tr>
            <th>Member ID</th>
            <th>Name</th>
            <th>Mobile</th>
            <th>Email</th>
            <th>Joined</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
    
    <br>
    <div style="text-align:center">
      <button onclick="exportMembers()" style="padding:10px 20px;background:#6366f1;color:#fff;border:none;border-radius:8px;cursor:pointer;font-weight:700">
        ?? Export All Members (CSV)
      </button>
    </div>
  </div>
</div>
<script src="auth.js"></script>
<script>
async function load(){
  try{
    const data = await AUTH.api('/api/admin/overview');
    document.getElementById('mcount').textContent = data.totals.members;
    document.getElementById('acount').textContent = data.totals.active_members;
    const tbody = document.querySelector('#tbl tbody');
    tbody.innerHTML = '';
    data.latest.forEach(r=>{
      const tr = document.createElement('tr');
      const status = r.membership_active ? '<span style="color:#22c55e">? Active</span>' : '<span style="color:#ef4444">? Inactive</span>';
      tr.innerHTML = `<td><strong>${r.member_id}</strong></td><td>${r.name||''}</td><td>${r.mobile||''}</td><td style="font-size:13px">${r.email||'-'}</td><td>${r.created_at}</td><td>${status}</td>`;
      tbody.appendChild(tr);
    });
  }catch(e){
    alert('Session expired or unauthorized');
    location.href='admin-login.html';
  }
}

// Export members to CSV
async function exportMembers(){
  try{
    const data = await AUTH.api('/api/admin/all-members');
    if(!data.members || data.members.length === 0){
      alert('No members to export');
      return;
    }
    
    // Create CSV content
    let csv = 'Member ID,Name,Mobile,Email,Status,Joined Date\n';
    data.members.forEach(m => {
      const status = m.membership_active ? 'Active' : 'Inactive';
      csv += `${m.member_id},"${m.name}",${m.mobile},"${m.email||'-'}",${status},${m.created_at}\n`;
    });
    
    // Download CSV
    const blob = new Blob([csv], { type: 'text/csv' });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `FWF_Members_${new Date().toISOString().split('T')[0]}.csv`;
    a.click();
    window.URL.revokeObjectURL(url);
  }catch(e){
    alert('Failed to export members: ' + e.message);
  }
}

load();
</script>

